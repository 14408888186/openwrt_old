--- a/src/chinadns.c
+++ b/src/chinadns.c
@@ -187,7 +187,7 @@
   if (0 != dns_init_sockets())
     return EXIT_FAILURE;
 
-  max_fd = MAX(local_sock, remote_sock) + 1;
+  max_fd = (local_sock>remote_sock?local_sock:remote_sock) + 1;
   while (1) {
     FD_ZERO(&readset);
     FD_ZERO(&errorset);

